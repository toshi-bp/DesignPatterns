# `AbstractFactory`パターン

# 概要

- `AbstractFactory`パターンとは**部品の具体的な実装には注目せず, インターフェース(API)に注目する. そして, そのインターフェース(API)だけを使って, 部品を組み立て, 製品にまとめる.**
- サブクラスのレベルで具体的な実装を行う(`Template Method`パターン(第 3 章)と`Builder`パターンと同じ)

# サンプルプログラム

サンプルプログラムは, 「階層構造を持ったリンク集を HTML ファイルとして作る」というものである.

このプログラムでは, 以下の 3 つのパッケージに分かれたクラス群で構成されている.

- `factory`パッケージ
  - 抽象的な工場・部品・製品を含むパッケージ
- 無名パッケージ
  - `Main`クラスを含むパッケージ
- `listfactory`パッケージ
  - 具体的な工場・部品・製品を含むパッケージ(ここでは&lt;ul&gt;タグを使って実装)

クラス一覧は以下に示す通りである.

| パッケージ  | 名前        | 解説                                                          |
| ----------- | ----------- | ------------------------------------------------------------- |
| factory     | Factory     | 抽象的な工場を表すクラス(Link, Tray, Page を作る)             |
| factory     | Item        | Link と Tray を統一的に扱うためのクラス                       |
| factory     | Link        | 抽象的な部品:HTML のリンクを表すクラス                        |
| factory     | Tray        | 抽象的な部品:Link や Tray を集めたクラス                      |
| factory     | Page        | 抽象的な部品:HTML のページを表すクラス                        |
| 無名        | Main        | 動作テスト用のクラス                                          |
| listfactory | ListFactory | 具体的な工場を表すクラス(ListLink, ListTray, ListPage を作る) |
| listfactory | ListLink    | 具体的な部品:HTML のリンクを表すクラス                        |
| listfactory | ListTray    | 具体的な部品:Link や Tray を集めたクラス                      |
| listfactory | ListPage    | 具体的な部品:HTML のページを表すクラス                        |

## 備考

- `Item`クラスは`Link`と`Tray`のスーパークラスになっている.
  - `Link`と`Tray`を同一視するため
  - `caption`フィールドは, この項目の「見出し」を表す
  - `makeHTML`は抽象メソッドであり, サブクラスで実装が期待されている
    - このメソッドを呼び出すと, HTML の文字列が戻り値となる(そうなるようにサブクラスで設定する)
- `Link`クラスは, HTML のハイパーリンクを抽象的に表現したクラスである
  - `url`フィールドは, リンクの飛び先の URL を保持するためのものである
  - `Link`クラス自体も抽象クラスである
    - スーパークラス(`Item`クラス)の抽象メソッド(`makeHTML`メソッド)が実装されていないため
- `Tray`クラスは複数の`Link`や`Tray`を集めてひとまとまりにしたものを表すクラスである
  - お盆(tray)の上に箇条書きの項目を 1 つ 1 つ載せるイメージ
  - `Link`や`Tray`は`add`メソッドを使って集める
    - 汎用性を上げるため `Link`と`Tray`のスーパークラスである`Item`を引数に取る
  - `Tray`クラス自体も抽象クラスである
    - `makeHTML`メソッドの継承をしているが, 実装はしていないため
- `Page`クラスは HTML 全体を抽象的に表現したクラスである
  - 抽象的な「製品」のイメージ
  - `title`→ ページのタイトル, `author`→ ページの作者(作者名はコンストラクタへの引数は指定)
  - ページには. `add`メソッドを使って`Item`を追加し, 追加されたものを表示
  - `output`メソッドの中ではタイトルを元にファイル名を決定し, `makeHTML`メソッドを使って, 自分自身の HTML の内容をファイルに書き込んでいる
    - `output`メソッドは`Template Method`パターンになっている
- `Factory`クラスは抽象的な工場を表す
  - `getFactory`メソッドは, クラス名を指定して具体的な工場のインスタンスを作成する
    - 作成する具体的な工場のクラス名を文字列で指定
    - `forName`メソッドを使って, そのクラスを動的に読み込む
    - そして, `newInstance`メソッドを使って, そのクラスのインスタンスを 1 個作成する
  - まだ途中aaa
- `Main`クラスでは, 抽象的な工場を使って抽象的な部品を製造し, 抽象的な製品を組み立てている
  - **このクラスでは, 具体的な部品・製品・工場を一切利用していない**
  - 具体的な工場のクラス名はコマンドラインから指定
  - 入力後, `Link`, `Tray`を作り, 作成した`Tray`の中に`Link`や`Tray`を入れ, 最後に`Page`を作って, `output`を行う
- `ListFactory`クラスでは`Factory`クラスの抽象メソッド`createLink`, `createTray`, `createPage`を実装している
  - ここでは単に`ListLink`, `ListTray`, `ListPage`を`new`している
  - `Prototype`パターンを使って`clone`を行う場合もあるかもしれない
- `ListLink`クラスは`Link`クラスのサブクラスである
  - スーパークラスで抽象メソッドだった`makeHTML`の実装を行っている
- `ListTray`クラスは`Tray`クラスのサブクラスである
  - このクラスでも`makeHTML`の実装を行っている
  - `tray`フィールドの中には, HTML として出力すべき`Item`達が集められている

# 登場人物

- ## ``()

# パターンを使う意義

##

-

# 関連しているパターン

- パターン(第`num`章)
