# `Builder`パターン

# 概要
`Builder`パターンとは建築物などの構造を持っている大きなものを建築したり構築したりする際に, 一気に完成させるのではなく, まず全体を構成している各部分を作り, 段階を踏んで組み上げていくように, 構造を持ったインスタンスを組み上げていくパターンである.

# サンプルプログラム
サンプルプログラムでは, `Builder`パターンを使って「文書」を作成するプログラムを作成する. ここで作成する文書は以下のような構造を持っている.

- タイトルを1つ含む
- 文字列をいくつか含む
- 箇条書きの項目をいくつか含む

`Builder`クラスでは, 文書を構成するメソッドを定める. そして, `Director`クラスがそのメソッドを使って, 具体的な1つの文書を作成する.

`Builder`クラスは抽象クラス→実際の処理は書かれていない→具体的な処理はサブクラスにて定義

`Builder`クラスのサブクラスは以下に示す通りである.
- `TextBuilder`クラス
    - プレーンテキスト(普通の文字列)を使って文書を作る
- `HTMLBuilder`クラス
    - HTMLを使って文書を作る

`Director`クラスでどのクラスを使うのかを決める

各クラスの名前と解説一覧は以下に示す通りである

| 名前 | 解説 |
| --- | --- |
| Builder | 文書を構成するためのメソッドを定めた抽象クラス |
| Director | 1つの文書を作るクラス |
| TextBuilder | プレーンテキスト(普通の文字列)を使って文書を作るクラス |
| HTMLBuilder | HTMLファイルを使って文書を作るクラス |
| Main | 動作テスト用のクラス |

## 備考
- `Builder`クラスは「文書」を作るメソッドを宣言している抽象クラス
    - `makeTitle`, `makeString`, `makeItems`は, それぞれタイトル, 文字列, 箇条書きを文書中に構築するメソッド, `close`メソッドは文書を完成させるメソッド
- `Director`クラスでは, `Builder`クラスで宣言されているメソッドを使って文書を作る
    - コンストラクタの引数は`Builder`型
        - しかし, 実際に`Builder`クラスのインスタンスが引数として与えられることはない
        - `Builder`クラスは抽象クラスであり, インスタンスを作れない
        - 実際に渡されるのは, `Builder`クラスのサブクラスのインスタンス
        - 与えられた`Builder`クラスのサブクラスによって, `Director`クラスが作る具体的な文書の形式が定まる
    - `construct`メソッドは, 文書を作るメソッド
        - 呼び出すと文書が構築される
        - `construct`メソッドを使うのは, `Builder`クラスで宣言されているメソッドだけである
- `TextBuilder`クラスは, プレーンテキストを使って文書を構築する`Builder`のサブクラスである. 結果はStringで返す
    - 文書を構築していくフィールド`buffer`が`String`クラスではなく, `StringBuffer`クラスになっているのは修正や追加の度に新しいインスタンスを生成することがなく高速であるからである(問題7-4)
- `HTMLBuilder`クラスは, 文書をHTMLファイルとして構築する
- `Main`クラスは, `Builder`パターンのテストプログラムである
    - 以下のように, コマンドラインで指定した形式に応じた文書の作成を行う
    - `java Main plain`→プレーンテキストで文書を作成
    - `java Main html`→HTMLで文書を作成
    - `Director`は, 実際に動いているものが`TextBuilder`か`HTMLBuilder`かを意識していない

# 登場人物
- `Builder`(建築者)
    - `Builder`役は, インスタンスを作成するためのインターフェース(API)を定める
    - インスタンスの各部分を作るためのメソッドが用意される
    - サンプルプログラムでは, `Builder`クラスがこの役を務めた
- `ConcreteBuilder`(具体的建築者)
    - `ConcreteBuilder`役は, `Builder`役のインターフェース(API)を実装しているクラス
    - 実際のインスタンス作成で呼び出されるメソッドは, ここで定義される
    - 最終的にできた結果を得るためのメソッドも用意される
    - サンプルプログラムでは, `TextBuilder`クラスや`HTMLBuilder`クラスがこの役を務めた
- `Director`(監視者)
    - `Director`役は, `Builder`役のインターフェース(API)を使ってインスタンスを生成する
    - `ConcreteDirector`役に依存したプログラミングは行わない
    - `Builder`役のメソッドのみを使う
        - `ConcreteBuilder`役が何であってもうまく機能するようにするため
    - サンプルプログラムでは, `Director`クラスがこの役を務めた
- `Client`(依頼人)
    - `Builder`パターンを利用する役
    - サンプルプログラムでは, `Main`クラスがこの役を務めた

# パターンを使う意義
## 誰が何を知っているか
- オブジェクト指向プログラミングにおいて「誰が何を知っているか」はとても大切である
    - どのクラスがどのメソッドを使えるか(使ってよいか)に注意してプログラミングする必要がある
- 「**知らないからこそ入れ替えができる**」→「**交換可能性**」
    - 交換可能性が高いと部品としての価値は高くなる
## 設計時に決められること, 決められないこと
- `Builder`クラスでは, 文書の構築(目的の達成)に必要かつ十分なメソッド群を宣言している必要がある
- `Director`クラスに与えられる道具は, `Builder`クラスが提供するものであるため, `Builder`クラスのメソッドとして何を用意するかは大事である
- `Builder`クラスは, 将来増えるかもしれない`Builder`クラスのサブクラスたちの要求にも応える必要がある

→**近い将来に起こることが予想されている変化には耐えられるように設計を行う必要がある**

## ソースの読み方, 修正の仕方
プログラミングをおこなとき, 既にできているソースへの修正や追加を行うことになるケースが多く存在する. その際にどうすればよいか？？
- 既存のソースを読む
    - しかし, 抽象クラスだけを眺めていてもあまり情報は得られない
    - サンプルプログラムでは, `Builder`クラス(抽象クラス)だけでなく, `Director`クラスのソースを読んで`Builder`クラスの近い方を理解する必要がある
- プログラムの修正や追加を行う場合, クラスの役割を理解していないとどのクラスを変更すべきかの判断を誤ってしまう

# 関連しているパターン
- `Template Method`パターン(第3章)
- `Composite`パターン(第11章)
- `Abstract Factory`パターン(第8章)
- `Facade`パターン(第15章)